<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Vim实用技巧</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos499535" class="calibre_8"><span class="calibre1"><span class="bold">技巧86查找当前高亮选区中的文本</span></span></p><p class="calibre_9"> 在普通模式下，*命令让我们可以查找光标下的单词。通过一小段Vim脚本，我们可以重新定义可视模式下的*命令，使其可以查找当前选中的文本，而不是光标下的单词。 </p><p class="calibre_8"><span class="calibre3"><span class="bold">在可视模式下查找当前单词</span></span></p><p class="calibre_9">在可视模式下，<span class="bold">*</span>命令将查找光标下的单词。注意观察下面的例子：</p><p class="calibre_"><img src="images/00062.jpg" class="calibre_234"/></p><p class="calibre_7">首先，我们在可视模式下选中了前3个单词，并将光标置于单词“sea”之上。当我们调用<span class="bold">*</span>命令时，会正向查找下一处单词“sea”，结果扩大了高亮选区的范围。尽管此行为与普通模式下的<span class="bold">*</span>命令一致，但我觉得毫无用处。</p><p class="calibre_7">我在对Vim着迷之前，用的是另外一款编辑器，它本身就自带一条“对已选的内容进行查找”的命令，于是，我将其映射为触手可及的快捷键并一直使用它。当我转到Vim工作环境时，却惊奇地发现Vim竟然没有此类功能。而我一直有种错觉，在可视模式下用<span class="bold">*</span>命令可以查找当前选中的内容，而不是当前单词。为此，我们可以用一小段Vim脚本，来实现此功能。</p><p class="calibre_8"><span class="calibre3"><span class="bold">查找当前选中的文本（现有技术）</span></span></p><p class="calibre_9">如果你查询<span class="bold">:h visual-search</span><img src="images/00243.jpg" class="calibre_10"/>，会发现这样一条建议：</p><p class="calibre_"><img src="images/00065.jpg" class="calibre_235"/></p><p class="calibre_7">下面这个键盘映射能够将当前的选择区作为关键字进行搜索：</p><p class="calibre_"><img src="images/00067.jpg" class="calibre_236"/></p><p class="calibre_7"> 注意：某些特殊字符（例如'.'和'*'）可能会引起问题。 </p><p class="calibre_7">首先，<span class="bold">y</span>命令会复制当前高亮选区的文本。然后，<span class="bold">/&lt;C-r&gt;"&lt;CR&gt;</span>调出查找提示符，并将无名寄存器的内容粘贴进来。最后，执行查找命令。此方案很简单，但正如Vim文档所告诫我们的那样，它有一定的局限性。</p><p class="calibre_7">在技巧78中，我们已经学过如何克服这些限制。现在让我们将此理论付诸于实践，创建一个可以查找当前选中文本的映射项，不受特殊字符的干扰。</p><p class="calibre_8"><span class="calibre3"><span class="bold">查找当前选中的文本（终极版）</span></span></p><p class="calibre_9">用以下这段Vim脚本就能够完成任务：</p><p class="calibre_"><img src="images/00072.jpg" class="calibre_237"/></p><p class="calibre_7">你可以直接将这段代码粘贴至你的<span class="bold">vimrc</span>文件中，或者安装visual star search插件<sup class="calibre5"><small id="filepos503032" class="calibre6"><a href="#filepos503742" class="calibre2"><span class="calibre7"><span class="calibre_2"><span class="underline">(2)</span></span></span></a></small></sup>。</p><p class="calibre_7">在上面的脚本中，不仅<span class="bold">*</span>命令的原有功能被覆盖了，<span class="bold">#</span>命令也被重新定义为反向查找选中的文本了。<span class="bold">xnoremap</span>关键字指明此映射项只在可视模式下有效，不包括选择模式（参见<span class="bold">:h mapmode-x</span><img src="images/00243.jpg" class="calibre_10"/>）。</p><p class="calibre_5">
<a id="filepos503577" class="calibre2"></a><a href="index_split_097.html#filepos491149" class="calibre2"><span class="calibre_2"><span class="underline">(1)</span></span></a> http://github.com/kana/vim-textobj-lastpat </p><p class="calibre_5">
<a id="filepos503742" class="calibre2"></a><a href="#filepos503032" class="calibre2"><span class="calibre_2"><span class="underline">(2)</span></span></a> https://github.com/nelstrom/vim-visual-star-search </p><div class="mbp_pagebreak" id="calibre_pb_112"></div>
</body></html>
