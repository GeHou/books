<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Vim实用技巧</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos518604" class="calibre_8"><span class="calibre1"><span class="bold">技巧90重用上次的查找模式</span></span></p><p class="calibre_9">将substitute命令的查找域留空，意味着Vim将会重用上次的查找模式。我们可以利用这一特点精简工作过程。</p><p class="calibre_6">事实明摆着，为了执行一次substitute命令，我们必须要打很多字。首先，指定命令的执行范围；然后，输入查找模式以及替换域的内容；最后，在命令末尾添加合适的标志位。由此可见，我们需要考虑的东西有很多，无论在哪一字段敲错了键，都有可能导致结果出现偏差。</p><p class="calibre_7">好消息是当我们把查找域留空时，就会让Vim使用当前的模式。</p><p class="calibre_7">看看这个庞大的substitute命令吧（技巧85）：</p><p class="calibre_8"><span class="bold">➾:%s/\v'(([^']|'\w)+)'/“\1”/g</span></p><p class="calibre_9">它等价于以下两条单独的命令：</p><p class="calibre_8"><span class="bold">➾ /\v'(([^']|'\w)+)' </span></p><p class="calibre_8"><span class="bold">➾:%s//“\1”/g</span></p><p class="calibre_9">那又怎样？因为不管怎么变，我们还是得输入完整的模式，对吧？但这并不是关键。执行substitute命令通常包括两个步骤：一是撰写查找模式，二是设计合适的替换字符串。因此，一分为二的技术让我们消除了这两项任务的耦合性，这才是关键所在。</p><p class="calibre_7">在我们撰写复杂的正则表达式过程中，通常需要尝试多次才能达到正确的匹配效<a class="calibre2"></a>果。如果打算通过执行substitute命令的方式来验证模式的话，每次执行命令都会改变文档的内容，这样做简直太麻烦了。与之形成鲜明对比的是，当执行查找命令时，文档不会被修改。因此，即使我们犯的错误再多也无所谓。在技巧85中，我们见识了一套有效构建正则表达式的工作流程。总之，将两个任务彻底分开，将使得我们的工作过程更加清晰。正所谓，万事俱备，一举成功。</p><p class="calibre_7">另外，谁说我们非得输入模式了？在技巧86中，我们就通过一小段Vim脚本，在可视模式中新增加了一条命令，其作用相当于<span class="bold">*</span>命令。当我们在文档中任意选中一段文本后，该映射项允许我们按<span class="bold">*</span>键来查找这段文本。接下来，我们就可以用一条查找域为空的substitute命令，把选中的内容（以及其他匹配）替换掉了。够懒的吧！</p><p class="calibre_8"><span class="calibre3"><span class="bold">并非永远奏效</span></span></p><p class="calibre_9">我的意思并不是说绝对不能在substitute命令的查找域中输入文本。例如，下面的substitute命令会把文件中每一行的换行符都替换为逗号，最终形成一行。</p><p class="calibre_8"><span class="bold">➾:%s/\n/,</span></p><p class="calibre_9">对于这种简单的命令，就没必要将它一分为二了。否则的话，非但得不到什么好处，反而有可能增加工作量。</p><p class="calibre_8"><span class="calibre3"><span class="bold">对命令历史的影响</span></span></p><p class="calibre_9">另外需要注意一点，把查找域留空，会在命令历史中留下一项不完整的记录。由于模式通常保存在Vim的查找历史记录中，而substitute命令则保存于Ex命令的历史记录中（参见<span class="bold">:h cmdline-history</span><img src="images/00243.jpg" class="calibre_10"/>）。因此，将查找任务与替换任务分离，会致使这两组信息被单独存放，从而导致当你再想重用之前的substitute命令时，会遇到困难。</p><p class="calibre_7">如果你觉得将来会以完整形式来调用历史记录中的substitute命令，就要养成在查找域中填充内容的习惯。你只需在命令行中输入<span class="bold">&lt;C-r&gt;/</span>，即可把上次的查找内容粘贴进来。因此，通过以下命令，我们就可以在命令历史中创建一项完整的记录。</p><p class="calibre_8"><span class="bold">➾:%s/&lt;C-r&gt;//“\1”/g</span></p><p class="calibre_9">在使用substitute命令时将查找域留空，有时很方便，有时却很麻烦。两种方法都体验一下，你就会形成自己的直觉，并依此来判断使用的时机。就像我常说的那样，要靠你自己的判断。</p><p class="calibre_5">
<a class="calibre2"></a>
</p><div class="mbp_pagebreak" id="calibre_pb_118"></div>
</body></html>
