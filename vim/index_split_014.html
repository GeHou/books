<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Vim实用技巧</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos76191" class="calibre_8"><span class="calibre1"><span class="bold">技巧12双剑合璧，天下无敌</span></span></p><p class="calibre_9"> Vim的强大很大程度上源自操作符与动作命令相结合。在本节，我们将看到它是如何工作的，并考虑其寓义。 </p><p class="calibre_8"><span class="calibre3"><span class="bold">操作符 + 动作命令 = 操作</span></span></p><p class="calibre_9"><span class="bold">d{motion}</span>命令可以对一个字符（<span class="bold">dl</span>）、一个完整单词（<span class="bold">daw</span>）或一整个段落（<span class="bold">dap</span>）进行操作，它作用的范围由动作命令决定。<span class="bold">c{motion}</span>、<span class="bold">y{motion}</span>以及其他一些命令也类似，它们被统称为操作符（operator）。你可以用<span class="bold">:h operator:h aw</span><img src="images/00243.jpg" class="calibre_10"/>来查阅完整的列表，表2-1总结了一些比较常见的操作符。</p><p class="calibre_7"><span class="bold">g~</span>、<span class="bold">gu</span>和<span class="bold">gU</span>命令要用两次按键来调用，我们可以把上述命令中的<span class="bold">g</span>当做一个前缀字符，用以改变其后面的按键行为，进一步的讨论请参见本技巧最后的“结识操作符待决模式”部分。</p><p class="calibre_7">操作符与动作命令的结合形成了一种语法。这种语法的第一条规则很简单，即一个操作由一个操作符，后面跟一个动作命令组成。学习新的动作命令及操作符，就像是在学习Vim的词汇一样。如果掌握了这一简单的语法规则，在词汇量增长时，就能表达更多的想法。</p><p class="calibre_7">假如我们已经知道如何用<span class="bold">daw</span>删除一个单词，然后又学到<span class="bold">gU</span>命令（参见<span class="bold">:h gU</span><img src="images/00243.jpg" class="calibre_10"/> ）。它也是个操作符，所以我们可以用<span class="bold">gUaw</span>把当前单词转换成大写形式。如果我们的词<a class="calibre2"></a>汇进一步扩充，学会了作用于段落的<span class="bold">ap</span>动作命令，就会发现我们可以进行两个新的操作：用<span class="bold">dap</span>删除整个段落，或者用<span class="bold">gUap</span>把整段文字转换为大写。</p><p class="calibre_7">Vim的语法只有一条额外规则，即当一个操作符命令被连续调用两次时，它会作用于当前行。所以<span class="bold">dd</span>删除当前行，而<span class="bold">&gt;&gt;</span>缩进当前行。<span class="bold">gU</span>命令是一种特殊情况，我们既可以用<span class="bold">gUgU</span>，也可以用简化版的<span class="bold">gUU</span>来使它作用于当前行。</p><blockquote class="calibre_26">
<span class="bold">表 2-1 Vim的操作符命令</span>
</blockquote><blockquote class="calibre_26">
<img src="images/00150.jpg" class="calibre_39"/><br class="calibre4"/>
</blockquote><p class="calibre_8"><span class="calibre3"><span class="bold">扩展命令组合的威力</span></span></p><p class="calibre_9">使用Vim缺省的操作符和动作命令，我们能够执行的操作的数目是巨大的，然而，我们还可以通过自定义动作命令及操作符来进一步扩充其数目。让我们想想这寓示着什么。</p><p class="calibre_8"><span class="calibre3"><span class="bold">自定义操作符与已有动作命令协同工作</span></span></p><p class="calibre_9">随同Vim发布的标准操作符集合相对比较少，但我们可以定义新的操作符。Tim Pope的commentary.vim插件提供了一个很好的例子<sup class="calibre5"><small id="filepos79740" class="calibre6"><a href="#filepos84552" class="calibre2"><span class="calibre7"><span class="calibre_2"><span class="underline">(2)</span></span></span></a></small></sup>，此插件为Vim所支持的编程语言增添了注释及取消注释的命令。</p><p class="calibre_7">注释命令以<span class="bold">\\{motion}</span>触发，它会切换指定行的注释状态。它是一个操作符命令，因此可以把它和所有动作命令结合在一起。<span class="bold">\\ap</span>将切换当前段落的注释状态，<span class="bold">\\G</span>会把从当前行到文件结尾间的所有内容注释掉，而<span class="bold">\\\</span>则注释当前行。</p><p class="calibre_7">如果你对如何创建自定义操作符感到好奇，可以先阅读一下文档<span class="bold">: h :map-operator</span><img src="images/00243.jpg" class="calibre_10"/> 。</p><p class="calibre_5">
<a class="calibre2"></a>
</p><p class="calibre_8"><span class="calibre3"><span class="bold">自定义动作命令与已有操作符协同工作</span></span></p><p class="calibre_9">Vim缺省的动作命令集已经相当全面了，但是我们还是可以定义新的动作命令及文本对象来进一步增强它。</p><p class="calibre_7">Kana Natsuno的textobj-entire插件是一个很好的例子<sup class="calibre5"><small id="filepos81015" class="calibre6"><a href="#filepos84714" class="calibre2"><span class="calibre7"><span class="calibre_2"><span class="underline">(3)</span></span></span></a></small></sup>，它为Vim增加了两种新的文本对象<span class="bold">ie</span>和<span class="bold">ae</span>，它们作用于整个文件。</p><p class="calibre_7">如果想用<span class="bold">=</span>命令自动缩进整个文件，我们可以执行<span class="bold">gg=G</span>（就是说，先用<span class="bold">gg</span>跳到文件开头，然后用<span class="bold">=G</span>自动缩进从光标位置到文件结尾的所有内容）。但是如果我们安装了textobj-entire插件的话，简单地执行<span class="bold">=ae</span>就可以了。运行这条命令时光标在哪儿并不重要，因为它总是作用于整个文件。</p><p class="calibre_7"> 注意：如果我们同时安装了commentary和textobj-entire插件，就可以把它们放在一起使用。例如，执行\\ae会切换整个文件的注释状态。 </p><p class="calibre_7">如果你对如何创建自定义动作命令感到好奇，可以由阅读<span class="bold">:h omap-info:h aw</span><img src="images/00243.jpg" class="calibre_10"/>开始。</p><p class="calibre_6">结识操作符待决模式</p><p class="calibre_6"> 普通、插入及可视模式很容易辨识，但是Vim还有另外一些很容易被忽视的模式，操作符待决模式（Operator-Pending mode）就是一个例子。每天我们无数次地使用它，但通常它只持续不到一秒时间。举个例子，在我们执行命令dw时，就会激活该模式。这一模式只在按d及w键之间的短暂时间间隔内存在，一眨眼工夫就不见了。 </p><p class="calibre_7"> 如果我们把Vim想象成有限状态机，那么操作符待决模式就是一个只接受动作命令的状态。这个状态在我们调用操作符时被激活，然后什么也不做，直到我们提供了一个动作命令，完成整个操作。当操作符待决模式被激活时，我们可以像平常一样按&lt;Esc&gt;中止该操作，返回到普通模式。 </p><p class="calibre_5">
<a class="calibre2"></a>
</p><p class="calibre_7">很多命令都由两个或更多的按键来调用（查阅:h g <img src="images/00243.jpg" class="calibre_10"/>、:h z<img src="images/00243.jpg" class="calibre_10"/> 、:h ctrl-w<img src="images/00243.jpg" class="calibre_10"/></p><p class="calibre_7"> ，或者 :h [<img src="images/00243.jpg" class="calibre_10"/>，可以看到一些例子），但在多数情况下，头一个按键只是第二个按键的前缀。这些命令不会激活操作符待决模式，相反，可以把它们当成命名空间（namespace），用来扩充可用命令的数目。只有操作符才会激活操作符待决模式。 </p><p class="calibre_7"> 你也许想知道，为什么要有一个完整的模式，专门用于操作符和动作命令之间的短暂瞬间，而命名空间命令则仅仅是普通模式的一个扩充？好问题！这是因为我们能够创建自定义映射项来激活或终结操作符待决模式。换句话说，它允许我们创建自定义的操作符及动作命令，从而让我们可以扩充Vim的词汇。 </p><p class="calibre_5">
<a id="filepos84410" class="calibre2"></a><a href="index_split_011.html#filepos61422" class="calibre2"><span class="calibre_2"><span class="underline">(1)</span></span></a> http://vimgolf.com/ </p><p class="calibre_5">
<a id="filepos84552" class="calibre2"></a><a href="#filepos79740" class="calibre2"><span class="calibre_2"><span class="underline">(2)</span></span></a> https://github.com/tpope/vim-commentary </p><p class="calibre_5">
<a id="filepos84714" class="calibre2"></a><a href="#filepos81015" class="calibre2"><span class="calibre_2"><span class="underline">(3)</span></span></a> https://github.com/kana/vim-textobj-entire </p><div class="mbp_pagebreak" id="calibre_pb_16"></div>
</body></html>
