<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Vim实用技巧</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos529419" class="calibre_8"><span class="calibre1"><span class="bold">技巧92重复上一次substitute命令</span></span></p><p class="calibre_9"> 有的时候，我们可能要修正substitute命令的执行范围。原因多种多样，有可能是由于在第一次尝试运行substitute命令时犯了错，也有可能是我们想在另一个缓冲区中再次运行相同的命令。我们可以利用一些快捷方式更容易地重复substitute命令。 </p><p class="calibre_8"><span class="calibre2"><span class="bold">在整个文件范围内重复面向行的替换操作</span></span></p><p class="calibre_9">假设我们刚刚执行完以下命令（其作用范围为当前行）：</p><p class="calibre_8"><span class="bold">➾:s/target/replacement/g</span></p><p class="calibre_9">突然，我们意识到了失误，应该加上前缀<span class="bold">%</span>才对。幸好该命令没有造成什么不良后果。</p><p class="calibre_7">接下来，我们只需输入<span class="bold">g&amp;</span>（参见<span class="bold">:h g&amp;</span><img src="images/00243.jpg" class="calibre_10"/>），即可在整个文件的范围内重复这条命令。在效果上，它等同于以下命令：</p><p class="calibre_8"><span class="bold">➾:%s//~/&amp;</span></p><p class="calibre_9">这条命令可以详解为如下指令：用同样的标志位、同样的替换字符串、同样的查找模式以及新的执行范围<span class="bold">%</span>，重复上一次substitute命令。换句话说，该命令表示在整个文件的范围内重复上一次替换操作。</p><p class="calibre_7">当你下次再碰到某条substitute命令除了没加<span class="bold">%</span>前缀之外，其余都正确的时候，不妨试一试<span class="bold">g&amp;</span>。</p><p class="calibre_8"><span class="calibre2"><span class="bold">修正substitute命令的执行范围</span></span></p><p class="calibre_9">看一下这段代码：</p><p class="calibre_"><img src="images/00097.jpg" class="calibre_245"/></p><p class="calibre_7">假设我们想把它扩展成以下模样：</p><p class="calibre_"><img src="images/00101.jpg" class="calibre_246"/></p><p class="calibre_7">由于与现有的函数相比，新的<span class="bold">applyNumber</span>函数几乎没什么变化。因此，我们首先创建一份<span class="bold">applyName</span>函数的副本，然后用substitute命令将其中出现“Name”的地方改为“Number”。但表14-1所展示的操作流程有点问题。</p><p class="calibre_7">你能发现问题所在么？由于我们采用符号<span class="bold">%</span>作为范围值，从而导致每一处“Name”都被改成了“Number”。这样做显然不对，我们应该指定一个范围，限定substitute命令只作用于第二个函数（副本）中的那几行文本才对。</p><p class="calibre_7">不用担心。我们可以先简单地撤销一下，然后再进行修正（参见表14-2）。</p><p class="calibre_7">其中，<span class="bold">gv</span>命令会激活可视模式，并重新将上次被选中的文本高亮起来（我们已在技巧21中讨论过这一点）。而当我们在可视模式下按输入<span class="bold">:</span>时，表示范围的<span class="bold">:’&lt;,’&gt;</span>将被预先填充在命令行上，它限定了下一条命令只会在被选中的行上执行。</p><blockquote class="calibre_26">
<span class="bold">表14-1 ——使用了错误的substitute命令</span>
</blockquote><p class="calibre_220"><img src="images/00104.jpg" class="calibre_247"/>
<a></a>
<img src="images/00108.jpg" class="calibre_248"/></p><p class="calibre_7">另外，我们需要解释一下<span class="bold">:&amp;&amp;</span>命令，因为这两处<span class="bold">&amp;</span>符号的含义有所不同。前一个<span class="bold">&amp;</span>作为Ex命令<span class="bold">:&amp;</span>的组成部分，用作重复上一次的<span class="bold">:substitute</span>命令（参见<span class="bold">:h :&amp;</span><img src="images/00243.jpg" class="calibre_10"/>），而第二个<span class="bold">&amp;</span>则会重用上一次<span class="bold">:s</span>命令的标志位。</p><p class="calibre_8"><span class="calibre2"><span class="bold">结论</span></span></p><p class="calibre_9">我们总是可以指定一个新的范围，并使用<span class="bold">:&amp;&amp;</span>命令重新执行替换操作。至于上次用的范围是什么并不重要。具体来说，<span class="bold">:&amp;&amp;</span>命令本身只作用于当前行，<span class="bold">:'&lt;,'&gt;&amp;&amp;</span>会作用于高亮选区，而<span class="bold">:%&amp;&amp;</span>会作用于整个文件。正如我们已经看到的那样，<span class="bold">g&amp;</span>命令作为<span class="bold">:%&amp;&amp;</span>的快捷方式，使用起来会更方便一些。</p><blockquote class="calibre_26">
<span class="bold">表 14-2—— 更改substitute命令的范围</span>
</blockquote><p class="calibre_220"><img src="images/00113.jpg" class="calibre_249"/>
<a></a>
<img src="images/00132.jpg" class="calibre_250"/></p><p class="calibre_6">修正 &amp; 命令</p><p class="calibre_6"> &amp;命令是:s命令的同义词，用于重复上一次的替换操作。遗憾的是，不论我们使用什么标志位，&amp;命令都将忽略它们，这意味着本次替换的结果可能与上一次截然不同。 </p><p class="calibre_7"> 让&amp;来触发:&amp;&amp;命令会更有用，因为后者会保留标志位，从而使得执行命令的结果始终如一。以下映射项旨在修正普通模式下的&amp;命令，并为可视模式创建一个类似的命令。 </p><p class="calibre_"><img src="images/00268.jpg" class="calibre_251"/></p><div class="mbp_pagebreak" id="calibre_pb_120"></div>
</body></html>
