<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Vim实用技巧</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos593687" class="calibre_8"><span class="calibre1"><span class="bold">技巧103使用Vim的标签跳转命令，浏览关键字的定义</span></span></p><p class="calibre_9"> Vim 与ctags的集成，使得代码中的关键字变成了某种形式的超链接。这使得我们可以快速地跳转到关键字的定义处。接下来，我们将会看到如何使用普通模式下的&lt;C-]&gt;与g&lt;C-]&gt;命令及其相应的Ex命令。 </p><p class="calibre_5">
<a class="calibre2"></a>
</p><p class="calibre_8"><span class="calibre3"><span class="bold">跳转到关键字的定义处</span></span></p><p class="calibre_9">一旦我们按下<span class="bold">&lt;C-]&gt;</span>，光标将会从当前所在的关键字跳转到它的定义处。下表展示了实际的操作过程：</p><p class="calibre_"><img src="images/00247.jpg" class="calibre_272"/></p><p class="calibre_7">在本例中，<span class="bold">Anglophone</span>类的定义恰巧在同一个缓冲区。但如果我们将光标移到<span class="bold">Speaker</span>关键字上，并调用相同的命令，结果将会切换到这个类定义所在的缓冲区。</p><p class="calibre_"><img src="images/00262.jpg" class="calibre_273"/></p><p class="calibre_7">当我们按照以上方式浏览整个代码库时，Vim会为我们访问过的标签维护一个历史列表。在浏览标签历史记录时，<span class="bold">&lt;C-t&gt;</span>命令会充当“后退按钮”的角色。如果我们此刻按下该键，光标会从<span class="bold">Speaker</span>的定义处回到<span class="bold">Anglophone</span>的定义处，而如<a class="calibre2"></a>果再按一次的话，光标会回到原位。有关与标签跳转列表交互的更多信息，请查阅<span class="bold">:h tag-stack</span><img src="images/00243.jpg" class="calibre_10"/>。</p><p class="calibre_8"><span class="calibre3"><span class="bold">当关键字存在多处匹配时，可指定跳转的位置</span></span></p><p class="calibre_9">前面的例子之所以一目了然，是因为示例代码库只包含<span class="bold">Speaker</span>与<span class="bold">Anglophone</span>关键字的一处定义。但假设我们的光标此时位于<span class="bold">speak</span>方法的调用处，例如：</p><p class="calibre_"><img src="images/00052.jpg" class="calibre_274"/></p><p class="calibre_7">而由于<span class="bold">Speaker</span>、<span class="bold">Francophone</span>以及<span class="bold">Anglophone</span>这3个类都定义了名为<span class="bold">speak</span>的函数，因此，如果我们此时调用<span class="bold">&lt;C-]&gt;</span>命令，Vim 会跳到哪个定义上呢？自己试试看。</p><p class="calibre_7">如果当前缓冲区有标签匹配此关键字，则它的优先级最高。针对本例，光标会跳转到<span class="bold">Anglophone</span>类的<span class="bold">speak</span>函数定义。如果你要了解更多有关Vim划分匹配标签优先级的情况，请查阅<span class="bold">:h tag-priority</span>
<img src="images/00243.jpg" class="calibre_10"/>。</p><p class="calibre_7">我们还可以用<span class="bold">g&lt;C-]&gt;</span>命令来代替<span class="bold">&lt;C-]&gt;</span>。如果当前关键字只有一处匹配，这两条命令的行为将完全一致，但如果发生了多处匹配的情况，<span class="bold">g&lt;C-]&gt;</span>命令会从标签匹配列表中挑出可选项供我们选择：</p><p class="calibre_"><img src="images/00031.jpg" class="calibre_275"/></p><p class="calibre_7">正如提示信息所示，我们只需输入相应的数字并按下<span class="bold">&lt;CR&gt;</span>键，就可以跳转到指定的位置了。</p><p class="calibre_7">假设我们已经调用了<span class="bold">&lt;C-]&gt;</span>，但发现光标所到之处并非如我们所愿。补救措施之一，是通过 <span class="bold">:tselect</span>命令，调出标签匹配列表，从而进行回溯。其次，我们还可以用<span class="bold">:tnext</span>命令直接跳转到下一处匹配的标签，这个过程不会显示提示信息。另外，正如你所预料的那样，我们也可以用<span class="bold">:tprev</span>、<span class="bold">:tfirst</span>、<span class="bold">:tlast</span>。你可以参考创建快速遍历Vim列表的按键映射项中的建议，为这些命令分别建立映射项。</p><p class="calibre_5">
<a class="calibre2"></a>
</p><p class="calibre_8"><span class="calibre3"><span class="bold">使用Ex命令</span></span></p><p class="calibre_9">其实，我们不必非得将光标移到关键字上，才能进行标签跳转，也可以用 Ex命令达到同样的目的。例如，<span class="bold">:tag {keyword}</span>与 <span class="bold">:tjump {keyword}</span>就分别等同于<span class="bold">&lt;C-]&gt;</span>与<span class="bold">g&lt;C-]&gt;</span>的功能（参见<span class="bold">:h :tag</span><img src="images/00243.jpg" class="calibre_10"/>与<span class="bold">:h :tjump</span><img src="images/00243.jpg" class="calibre_10"/>）。</p><p class="calibre_7">有的时候，手动输入这些命令，甚至会比把光标移动到某个关键字还要快，特别是当Vim为标签文件的所有关键字提供tab补全功能的时候。例如，我们只需输入<span class="bold">:tag Fran&lt;Tab&gt;</span>，Vim就会把这段内容扩展成完整的<span class="bold">Francophone</span>。</p><p class="calibre_7">另外，这些Ex命令也可以使用正则表达式，调用时需采用<span class="bold">:tag/{pattern}</span>或<span class="bold">:tjump /{pattern}</span>这种形式（注意位于<span class="bold">{pattern}</span>前面的<span class="bold">/</span> ）。例如，为了浏览所有以<span class="bold">phone</span>为结尾的关键字定义，可以调用以下命令：</p><p class="calibre_8"><span class="bold">➾:tjump /phone$</span></p><p class="calibre_8"><span class="calibre8"> 《 # pri kind tag </span></p><p class="calibre_5"><span class="calibre8"> 1 F C c Anglophone anglophone.rb </span></p><p class="calibre_5"><span class="calibre8"> class Anglophone &lt; Speaker </span></p><p class="calibre_5"><span class="calibre8"> 2 F c Francophone francophone.rb </span></p><p class="calibre_5"><span class="calibre8"> class Francophone &lt; Speaker </span></p><p class="calibre_5"><span class="calibre8"> Type number and &lt;Enter&gt; (empty cancels): </span></p><p class="calibre_7">下表总结了在使用标签进行代码浏览时的可用命令：</p><p class="calibre_"><img src="images/00027.jpg" class="calibre_276"/></p><p class="calibre_5">
<a id="filepos600268" class="calibre2"></a><a href="index_split_117.html#filepos582571" class="calibre2"><span class="calibre_2"><span class="underline">(1)</span></span></a> https://github.com/mozilla/doctorjs </p><p class="calibre_5">
<a id="filepos600426" class="calibre2"></a><a href="index_split_117.html#filepos585517" class="calibre2"><span class="calibre_2"><span class="underline">(2)</span></span></a> http://ctags.sourceforge.net/FORMAT </p><p class="calibre_5">
<a id="filepos600584" class="calibre2"></a><a href="index_split_118.html#filepos592021" class="calibre2"><span class="calibre_2"><span class="underline">(3)</span></span></a> http://tbaggery.com/2011/08/08/effortless-ctags-with-git.html </p><div class="mbp_pagebreak" id="calibre_pb_135"></div>
</body></html>
