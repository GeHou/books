<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Vim实用技巧</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos159012" class="calibre_8"><span class="calibre1"><span class="bold">技巧30在指定范围上执行普通模式命令</span></span></p><p class="calibre_9"> 如果想在一系列连续行上执行一条普通模式命令，我们可以用:normal命令。此命令在与.命令或宏结合使用时，我们只需花费很少的努力就能完成大量重复性任务。 </p><p class="calibre_7">想一下在技巧2中遇到过的例子，我们想在一系列行后添加一个分号。使用点范式让我们迅速完成了这项工作，但是在那个例子里，只需对连续的3行做此修改。如果不得不做50次同样的修改会怎么样呢？如果还用点范式的话，得按50次<span class="bold">j.</span>，总共得100次按键动作！</p><p class="calibre_7">这里有一种更好的方法。我们将在下面文件的每行后都添加一个分号，以此作为<a class="calibre2"></a>演示。为节省空间，此处只列出了5行内容，然而你可以想象这里有50行，那么这种方法看起来就颇具诱惑了。</p><p class="calibre_"><img src="images/00159.jpg" class="calibre_77"/></p><p class="calibre_7">我们像之前做的那样，首先修改第一行：</p><p class="calibre_6"><img src="images/00169.jpg" class="calibre_78"/></p><p class="calibre_6">接下来，用不着一行一行地执行<span class="bold">.</span>命令，而是使用Ex命令<span class="bold">:normal</span> 对整个范围内的所有行同时执行<span class="bold">.</span> 命令：</p><p class="calibre_6"><img src="images/00199.jpg" class="calibre_79"/></p><p class="calibre_6"><span class="bold">:'&lt;,'&gt;normal .</span>命令可以解读为“对高亮选区中的每一行，对其执行普通模式下的<span class="bold">.</span>命令”。无论是操作5行还是50行文本，这种方法都能出色地完成任务，更棒的是我们甚至都不需要计算行数，在可视模式中选中这些行使我们摆脱了计数的负担。</p><p class="calibre_7">这个例子使用<span class="bold">:normal</span>执行<span class="bold">.</span>命令，但是也可以用这种方式执行任意其他的普<a class="calibre2"></a>通模式命令。例如，可以用如下命令解决上面的问题：</p><p class="calibre_8"><span class="bold">➾:%normal A;</span></p><p class="calibre_9">符号<span class="bold">%</span>代表整个文件范围，因此<span class="bold">:%normal A;</span>告诉 Vim 在文件每行的结尾都添加一个分号。在做此修改时会切换到插入模式，但是在修改完后Vim会自动返回到普通模式。</p><p class="calibre_7">在执行指定的普通模式命令之前，Vim会先把光标移到该行的起始处。因此在执行时，用不着担心光标的位置。例如，下面这条命令可以把整个JavaScript文件注释掉：</p><p class="calibre_8"><span class="bold">➾:%normal i//</span></p><p class="calibre_9">虽然用<span class="bold">:normal</span>命令可以执行任意的普通模式命令，但是我发现当它和 Vim的重复命令结合在一起时，最为强大，既可以用<span class="bold">:normal .</span>应对简单的重复性工作，也可以用<span class="bold">:normal @q</span>应对较复杂的任务。具体的实例参见技巧67和技巧69。</p><p class="calibre_7">在Ex 命令影响范围广且距离远中，我们说过 Ex 命令可以一次修改若干行。而<span class="bold">:normal</span>命令则让我们可以把具有强大表现力的 Vim 普通模式命令与具有大范围影响力的 Ex 命令结合在一起，这种结合真地是珠联璧合！</p><p class="calibre_7">对本节所涉及问题的另外一种解决方案，请参见技巧26。</p><div class="mbp_pagebreak" id="calibre_pb_40"></div>
</body></html>
