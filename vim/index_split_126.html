<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Vim实用技巧</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos631071" class="calibre_8"><span class="calibre1"><span class="bold">技巧108不必离开Vim也能调用grep</span></span></p><p class="calibre_9"> Vim的:grep命令给外部grep（或类似grep的）程序提供了一层封装。凭借此命令，我们可以在不离开Vim的情况下通过grep实现在多个文件中查找某个模式，然后就可以用quickfix列表浏览这些查找结果了。 </p><p class="calibre_7">首先，我们将对一个工作过程进行分析，在此过程中，<span class="bold">grep</span>与Vim各自独立运行，没有任何调用关系。然后，我们将分析这种方法的弱点，再考虑使用集成的方案来解决这些问题。</p><p class="calibre_8"><span class="calibre2"><span class="bold">在系统命令行中执行grep</span></span></p><p class="calibre_9">假设我们正在Vim中编辑文本，突然想在当前目录的所有文件中查找单词“Waldo”。我们可以离开 Vim，在 shell 中执行下面的命令：</p><p class="calibre_8"><span class="bold">➾ $ grep -n Waldo *</span></p><p class="calibre_8"><span class="calibre6"> 《 department-store.txt:1:Waldo is beside the boot counter.</span><br class="calibre3"/><span class="calibre6"> goldrush.txt:6:Waldo is studying his clipboard.</span><br class="calibre3"/><span class="calibre6"> goldrush.txt:9:The penny farthing is 10 paces ahead of Waldo. </span></p><p class="calibre_7">在缺省情况下，<span class="bold">grep</span>会为每个匹配项打印一行，显示该匹配行的内容及所在的文件名。<span class="bold">-n</span>参数将指示<span class="bold">grep</span>在显示结果时加入行号信息。</p><p class="calibre_7">那么，我们能用这些结果做什么呢？当然，我们可以把其当成一个目录来用。对于结果中的每一行，我们都可以打开对应的文件，并指定要跳转的行号。例如，要跳转到<span class="bold">goldrush.txt</span>的第9行，我们可以在shell中运行以下命令：</p><p class="calibre_8"><span class="bold">➾ $ vim goldrush.txt +9</span></p><p class="calibre_9">这是不是有点麻烦？毋庸置疑的是，我们的工具能提供更好的集成。</p><p class="calibre_8"><span class="calibre2"><span class="bold">在Vim内部调用grep</span></span></p><p class="calibre_9">Vim的<span class="bold">:grep</span>命令是对外部<span class="bold">grep</span>程序的包装（参见<span class="bold">:h :grep</span><img src="images/00243.jpg" class="calibre_10"/>）。这样一来，我们就可以直接在 Vim 中执行<span class="bold">grep</span>，而不用到 shell 中执行了：</p><p class="calibre_8"><span class="bold">➾:grep Waldo *</span></p><p class="calibre_9">Vim将在后台为我们在shell中执行<span class="bold">grep -n Waldo *</span>。Vim 会对<span class="bold">grep</span>的输出进行更有用的处理，而不仅仅将它们显示出来。具体来讲，它会解析此输出，并由此创建一个 quickfix 列表。通过使用<span class="bold">:cnext/:cprev</span>命令以及在第17章介绍过的其他技术，我们可以浏览这些结果。</p><p class="calibre_7">尽管我们只调用了<span class="bold">:grep Waldo *</span>，但Vim会自动加入<span class="bold">-n</span>参数，指示<span class="bold">grep</span>在输出结果中加入行号信息。这就是为什么当我们在浏览quickfix列表时，可以直接跳转到每一处匹配所在行的原因。</p><p class="calibre_7">假设我们想让<span class="bold">grep</span>不区分大小写，则需要提供<span class="bold">-i</span>参数：</p><p class="calibre_8"><span class="bold">➾:grep -i Waldo *</span></p><p class="calibre_9">Vim将在幕后执行<span class="bold">grep -n -i Waldo *</span>。请注意，缺省的<span class="bold">-n</span>参数仍会出现。如果我们还想进一步控制<span class="bold">grep</span>的行为，可以按照同样的方式传递其他的参数。</p><div class="mbp_pagebreak" id="calibre_pb_144"></div>
</body></html>
