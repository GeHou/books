<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Vim实用技巧</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos60927" class="calibre_8"><span class="calibre1"><span class="bold">技巧9构造可重复的修改</span></span></p><p class="calibre_9">Vim对重复操作进行了优化，要利用这一点，我们必须考虑该如何构造修改。</p><p class="calibre_6">在Vim中，要完成一件事，总是有不止一种方式。在评估哪种方式最好时，最显而易见的指标是效率，即哪种手段需要的按键次数最少（又名VimGolf <sup class="calibre5"><small id="filepos61422" class="calibre6"><a href="index_split_014.html#filepos84410" class="calibre2"><span class="calibre7"><span class="calibre_2"><span class="underline">(1)</span></span></span></a></small></sup>。然而，在平局时该如何选择获胜者呢？</p><p class="calibre_7">在下例中，假设光标位于行尾处的字符“h”上，而我们想要删除单词“nigh”：</p><p class="calibre_5">
<a class="calibre2"></a>
</p><p class="calibre_"><img src="images/00130.jpg" class="calibre_31"/></p><p class="calibre_8"><span class="calibre3"><span class="bold">反向删除</span></span></p><p class="calibre_9">因为光标已经位于单词末尾，我们可以先反向删除该词。</p><p class="calibre_7"><img src="images/00133.jpg" class="calibre_32"/><br class="calibre4"/></p><p class="calibre_7">按<span class="bold">db</span>命令删除从光标起始位置到单词开头的内容，但会原封未动地留下最后一个字符“h”，再按一下<span class="bold">x</span>键就可以删除这个捣乱的字符。这样，整个操作的 Vim高尔夫得分是3分。</p><p class="calibre_8"><span class="calibre3"><span class="bold">正向删除</span></span></p><p class="calibre_9">这一次，让我们尝试一下正向删除。</p><p class="calibre_7"><img src="images/00134.jpg" class="calibre_33"/><br class="calibre4"/></p><p class="calibre_7">我们先用<span class="bold">b</span>命令把光标移到单词的开头，移动好后，就可以用一个<span class="bold">dw</span>命令删掉整个单词。这一次的Vim高尔夫得分也是3分。</p><p class="calibre_8"><span class="calibre3"><span class="bold">删除整个单词</span></span></p><p class="calibre_9">到目前为止，已有的两种方式都要先做某种准备工作或清理工作。另外，我们也可以使用更为精准的<span class="bold">aw</span>文本对象（text object），而不是用动作命令（参见<span class="bold">:h aw</span><img src="images/00243.jpg" class="calibre_10"/>）：</p><p class="calibre_7"><img src="images/00138.jpg" class="calibre_34"/><br class="calibre4"/></p><p class="calibre_7">你可以把<span class="bold">daw</span>命令解读为“delete a word”，这样比较容易记忆。在技巧51和技巧52中我们将介绍更多关于文本对象的细节。</p><p class="calibre_5">
<a class="calibre2"></a>
</p><p class="calibre_8"><span class="calibre3"><span class="bold">决胜局：哪种方式最具重复性？</span></span></p><p class="calibre_9">我们尝试了3种不同的方式来删除一个词：<span class="bold">dbx</span>、<span class="bold">bdw</span>以及<span class="bold">daw</span>。每种情况的Vim高尔夫得分都是3分。那么我们要怎么回答这个问题：“哪种方式最好？”</p><p class="calibre_7">还记得吗，Vim对重复操作进行了优化。让我们再回顾一下这3种方式，这一次我们跟着用一次<span class="bold">.</span>命令，看看会发生什么。我建议你自己也亲自试一下。</p><p class="calibre_7">反向删除方案包含两步操作：<span class="bold">db</span>命令删除至单词的开头，而后<span class="bold">x</span>命令删除一个字符。如果我们跟着执行一次<span class="bold">.</span>命令，它会重复删除一个字符（<span class="bold">.</span> = = <span class="bold">x</span>）。我不觉得这有什么价值。</p><p class="calibre_7">正向删除方案也包含两步。这一次，<span class="bold">b</span>只是一次普通的移动，而<span class="bold">dw</span>完成修改。此时用<span class="bold">.</span>命令会重复<span class="bold">dw</span>，删除从光标位置到下个单词开头的内容。不过因为我们刚好已经在行尾了，并没有“下一个单词”，所以在这个场景里<span class="bold">.</span>命令没什么用。不过，至少它代表了一个更长点的操作（<span class="bold">.</span> = = <span class="bold">dw</span>）。</p><p class="calibre_7">最后的方案只调用一个操作：<span class="bold">daw</span>。这个操作不仅仅删除了该单词，它还会删除一个空格，因此光标最终会停在单词“is”的最后一个字符上。如果此时我们使用<span class="bold">.</span>命令，它会重复上次删除单词的命令。这一次，<span class="bold">.</span>命令会做真正有用的事情（<span class="bold">.</span> = = <span class="bold">daw</span>）。</p><p class="calibre_8"><span class="calibre3"><span class="bold">结论</span></span></p><p class="calibre_9"><span class="bold">daw</span>可以发挥<span class="bold">.</span>命令的最大威力，因此我宣布它是本轮的获胜者。</p><p class="calibre_7">要想充分利用<span class="bold">.</span>命令，事先常常需要进行一番周详的考虑。如果你发现自己要在几个地方做同样的小修改，就可以尝试构造你的修改，让它们能够被<span class="bold">.</span>命令重复执行。要识别出这类机会需要进行一定的实践，不过一旦你养成了使修改可重复的习惯，那么你就会从 Vim 这里得到“奖赏”。</p><p class="calibre_7">有时，我并没有看到用<span class="bold">.</span>命令的机会，然而在做完一次修改后，我发现要做另一次同样的操作，这时候，我脑海里会浮现出<span class="bold">.</span>命令，而它也已经准备好为我效力了。每当遇到这种情况时，我都会开心地笑起来。</p><div class="mbp_pagebreak" id="calibre_pb_13"></div>
</body></html>
