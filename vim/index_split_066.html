<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Vim实用技巧</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos324963" class="calibre_8"><span class="calibre1"><span class="bold">技巧57跳转到光标下的文件</span></span></p><p class="calibre_9"> Vim会把文档中的文件名当成一个超链接。在进行了正确的配置后，我们就可以用gf命令跳转到光标下的文件了。 </p><p class="calibre_7">我们将用 jumps 目录作为演示，你可以在随本书发布的源码中找到该目录。它包含如下目录树结构：</p><p class="calibre_"><img src="images/00163.jpg" class="calibre_151"/></p><p class="calibre_7">我们先在 shell 里切换到 jumps 目录，然后再启动 Vim。在本例中，我建议用 -u NONE -N 参数启动 Vim，以确保 Vim 在启动时不加载任何插件：</p><p class="calibre_8"><span class="bold">➾$ cd code/jumps </span></p><p class="calibre_8"><span class="bold">➾$ vim -u NONE -N practical_vim.rb</span></p><p class="calibre_9">practical_vim.rb文件只是简单地包含 core.rb 及 more.rb文件：</p><p class="calibre_"><img src="images/00003.jpg" class="calibre_152"/></p><p class="calibre_7">如果能快速查看 require 指示符所指定的文件的内容，岂不是很棒吗？这正是Vim 的<span class="bold">gf</span>命令要实现的功能，你可以把这个命令想成“go to file”（参见<span class="bold">:h gf</span><img src="images/00243.jpg" class="calibre_10"/>）。</p><p class="calibre_7">让我们试一下该命令。先把光标放在字符串<span class="bold">'practical_vim/core'</span>的某个位置上（例如，按<span class="bold">fp</span>快速移到该字符串上），如果现在尝试执行<span class="bold">gf</span>命令的话，会遇到下面的错误“E447:在路径中找不到文件‘practical_vim/core’”。</p><p class="calibre_7">就是说，Vim 会尝试打开名为<span class="bold">practical_vim/core</span>的文件，并报告该文件不存在。其实，在目录中是有一个名为<span class="bold">practical_vim/core.rb</span>的文件的（留意一下文件的扩展名）。因此，我们需要以某种方法告诉 Vim ，让它在尝试打开文件前，对光标下的文件路径进行修改，为之加上<span class="bold">.rb</span>扩展名。我们可以用<span class="bold">‘suffixesadd’</span>选项做到这一点。</p><p class="calibre_8"><span class="calibre3"><span class="bold">指定文件的扩展名</span></span></p><p class="calibre_9"><span class="bold">‘suffixesadd’</span>选项允许我们指定一个或多个文件扩展名，当 Vim 用<span class="bold">gf</span>命令搜寻文件名时，会尝试使用这些扩展名（参见<span class="bold">:h 'suffixesadd'</span><img src="images/00243.jpg" class="calibre_10"/>）。用下面的命令可以设置此选项：</p><p class="calibre_8"><span class="bold">➾ :set suffixesadd+=.rb</span></p><p class="calibre_9">现在如果我们用<span class="bold">gf</span>命令的话，Vim就会直接跳转到光标下的文件路径。试着用它打开<span class="bold">more.rb</span>文件，然后在此文件中再找到其他一些<span class="bold">require</span>指令，随便挑一个用<span class="bold">gf</span>命令打开。</p><p class="calibre_7">每次用<span class="bold">gf</span>命令时，Vim 都会在跳转列表中增添一条记录，因此我们总是可以用<span class="bold">&lt;C-o&gt;</span>命令返回原处（参见技巧55）。在本例中，按一次<span class="bold">&lt;C-o&gt;</span> 会让我们回到<span class="bold">more.rb</span>，再按一次则会让我们回到<span class="bold">practical_vim.rb</span>中。</p><p class="calibre_5">
<a class="calibre2"></a>
</p><p class="calibre_8"><span class="calibre3"><span class="bold">指定要搜寻的目录</span></span></p><p class="calibre_9">在本例中，每个<span class="bold">require</span>语句所引用的文件都位于工作目录的相对路径中。但是，如果我们引用了第三方库所提供的功能，比如说rubygem，那该怎么办？</p><p class="calibre_7">这正是<span class="bold">'path'</span>选项的用处 (参见<span class="bold">:h 'path'</span><img src="images/00243.jpg" class="calibre_10"/>），我们可以把它配置成一个以逗号分隔的目录列表。当使用<span class="bold">gf</span>命令时，Vim 会检查<span class="bold">'path'</span>目录列表中的每个目录，看该目录中是否包含一个匹配光标下文本的文件名。<span class="bold">'path'</span>设置也会用于<span class="bold">:find</span>命令，我们已经在技巧42中介绍过该命令。</p><p class="calibre_7">用下面这条命令可以查看<span class="bold">'</span>path<span class="bold">'</span>选项的值：</p><p class="calibre_8"><span class="bold">➾:set path?</span></p><p class="calibre_8"><span class="calibre8"> 《 path=.,/usr/include,, </span></p><p class="calibre_7">在此设置中，<span class="bold">.</span>代表当前文件所在的目录，而空字符串（由两个连着的逗号界定）则代表工作目录。上述缺省值对于简单的例子可以工作得很好，但对于较大的工程来说，我们可能会想在<span class="bold">'path'</span>设置中包含更多的目录。</p><p class="calibre_7">例如，如果<span class="bold">'path'</span>能够包含一个 Ruby工程所用的全部 rubygems 的目录，那就会非常有用。因为这样一来，我们就可以用<span class="bold">gf</span>命令打开任何<span class="bold">require</span>语句所引用的模块。如果你想找一种自动解决方案的话，可以看一下 Tim Pope 的bundler.vim 插件<sup class="calibre5"><small id="filepos330448" class="calibre6"><a href="index_split_067.html#filepos337722" class="calibre2"><span class="calibre7"><span class="calibre_2"><span class="underline">(3)</span></span></span></a></small></sup>，它会使用工程的<span class="bold">Gemfile</span>来自动生成<span class="bold">'path'</span>设置。</p><p class="calibre_8"><span class="calibre3"><span class="bold">结论</span></span></p><p class="calibre_9">在本节一开始时，我建议在启动 Vim 时禁用所有插件。这是因为 Vim在发布时通常都附带一个 Ruby文件类型插件，此插件会为我们设置<span class="bold">'suffixesadd'</span>和<span class="bold">'path'</span>选项。如果你需要用 Ruby 完成大量的工作，那么我建议你从 github 上下载最新版本的文件类型插件，因为该插件的更新很频繁。<sup class="calibre5"><small id="filepos331143" class="calibre6"><a href="index_split_067.html#filepos337881" class="calibre2"><span class="calibre7"><span class="calibre_2"><span class="underline">(4)</span></span></span></a></small></sup></p><p class="calibre_7"><span class="bold">'suffixesadd'</span> 和<span class="bold">'path'</span>选项可以针对每个缓冲区进行设置，因此对不同的文件类型可以设置不同的值。除 Ruby 以外，Vim 在发布时也附带了很多其他编程语言的文件类型插件。因此在实际应用中，你不会自己经常设置这两个选项。即便如此，我们也值得花点时间理解<span class="bold">gf</span>命令是如何工作的。这条命令能让文档中每个文件路径<a class="calibre2"></a>都像超链接那样工作，使我们浏览代码变得更容易。</p><p class="calibre_7"><span class="bold">&lt;C-]&gt;</span>命令的作用也类似。它也需要进行一些配置（在技巧102中讨论），然而一旦正确配置好，它就允许我们从函数调用的地方直接跳到该函数定义的地方。移步技巧103可以看到一个实例。</p><p class="calibre_7">跳转列表和改变列表如同“面包屑小径”一样，它们允许我们沿原路返回。而<span class="bold">gf</span>和<span class="bold">&lt;C-]&gt;</span>命令则像是“虫洞”，它把我们从代码的一个地方传送到另一个地方。</p><div class="mbp_pagebreak" id="calibre_pb_75"></div>
</body></html>
