<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Vim实用技巧</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos643730" class="calibre_8"><span class="calibre1"><span class="bold">技巧110使用Vim内部的Grep</span></span></p><p class="calibre_9"><span class="bold">:vimgrep</span>命令允许我们使用Vim自带的正则表达式引擎，实现跨文件的查找功能。</p><p class="calibre_7">Vim提供了一条名为 <span class="bold">:vimgrep</span>的命令，它采用的是Vim内置的查找引擎（此命令可被缩写为<span class="bold">:vim</span>）。该命令的语法如下所示：</p><p class="calibre_75"><span class="calibre8"><span class="bold">:vim[grep][!] /{pattern}/[g][j] {file} ...</span></span></p><p class="calibre_75">当同一行内有多处匹配时，可以用<span class="bold">g</span>标志位为每处匹配创建一条记录。不然的话，Vim只会为整行文本创建一项记录。在缺省情况下，Vim将直接跳转到第一处匹配，但你也可以通过<span class="bold">j</span>标志位，让它只更新quickfix列表，但不跳到第一处匹配。</p><p class="calibre_7">参数<span class="bold">{file}</span>千万不能为空。它可接受的参数与<span class="bold">:args</span>命令的相同（有关更多细节，我们已在填充参数列表中有所讨论），包括文件名、通配符、反引号表达式以及这些内容的组合。通配符<span class="bold">*</span>会匹配某个目录下的任意文件，而通配符<span class="bold">**</span>则会匹配指定目录及其子目录中的任何文件。另外，我们可以使用符号<span class="bold">##</span>，它将被扩展成参数列表中的所有文件（参见<span class="bold">:h :_##</span><img src="images/00243.jpg" class="calibre_10"/>）。</p><p class="calibre_8"><span class="calibre3"><span class="bold">先在文件内查找，再扩大到整个工程</span></span></p><p class="calibre_9">使用<span class="bold">:vimgrep</span>的主要优点在于它能使用与查找命令相同的模式。因此，我们可以先在当前文件中查找，以这种方法撰写正则表达式，一旦我们对匹配结果感到满意，就可以使用完全相同的模式来执行<span class="bold">:vimgrep</span>了。在这里，我们将使用在技巧85中已<a class="calibre2"></a>经构造好的模式：</p><p class="calibre_8"><span class="bold">➾ /\v'(([^']|'\w)+)' </span></p><p class="calibre_8"><span class="bold">➾:vim /&lt;C-r&gt;// **</span></p><p class="calibre_9">假设我们想用<span class="bold">:grep</span>在工程范围内查找相同模式的话，必须首先将其转换成具有POSIX风格的正则表达式才行。</p><p class="calibre_8"><span class="calibre3"><span class="bold">查找历史与 :vimgrep的关系</span></span></p><p class="calibre_9">在上一例子中，我们采用的<span class="bold">&lt;C-r&gt;/</span>，把上次查找的内容粘贴至<span class="bold">:vimgrep</span>命令的模式域。如果你已经读过技巧90，可能会好奇，如果我们将模式域清空的话，会发生什么事情。</p><p class="calibre_7">遗憾的是，结果并非如我们所愿。如果模式域为空的话，<span class="bold">:vimgrep</span>命令将会匹配所有被查找文件内的所有文本行。</p><p class="calibre_7"><span class="bold">:substitute</span>以及<span class="bold">:global</span>这两条命令与Vim的查找历史紧密集成在一起。不论运行它们中的哪一条，如果模式域为空的话，Vim都会使用当前的查找模式。然而，如果我们在调用时提供了模式，Vim也会相应地更新当前查找的模式。而<span class="bold">:vimgrep</span>命令与Vim查找历史之间的关联程度并不像前两个命令那么高。因此，如果我们想重用最近一次的查找模式，必须通过<span class="bold">&lt;C-r&gt;/</span>将其直接粘贴至查找域才行。</p><p class="calibre_5">
<a id="filepos647431" class="calibre2"></a><a href="index_split_127.html#filepos642980" class="calibre2"><span class="calibre_2"><span class="underline">(1)</span></span></a> https://github.com/mileszs/ack.vim </p><p class="calibre_5">
<a id="filepos647588" class="calibre2"></a><a href="index_split_127.html#filepos643150" class="calibre2"><span class="calibre_2"><span class="underline">(2)</span></span></a> https://github.com/tpope/vim-fugitive </p><div class="mbp_pagebreak" id="calibre_pb_146"></div>
</body></html>
