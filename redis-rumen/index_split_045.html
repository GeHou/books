<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Redis入门指南（第2版）</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<blockquote id="filepos575695" class="calibre_11"><a href="index_split_000.html#filepos27687"><span class="calibre2"><span class="bold"><span class="calibre_2">9.1 安全</span></span></span></a></blockquote><p class="calibre_14">Redis的作者Salvatore Sanfilippo曾经发表过Redis宣言<sup class="calibre3"><small id="filepos575957" class="calibre4"><a href="index_split_047.html#filepos597352"><span class="calibre5"><span class="calibre_2">[1]</span></span></a></small></sup> ，其中提到Redis以简洁为美。同样在安全层面Redis也没有做太多的工作。</p><p id="filepos576154" class="calibre_6"><a href="index_split_000.html#filepos27883"><span class="calibre6"><span class="bold"><span class="calibre_2">9.1.1 可信的环境</span></span></span></a></p><p class="calibre_14">Redis的安全设计是在“Redis运行在可信环境”这个前提下做出的。在生产环境运行时不能允许外界直接连接到 Redis 服务器上，而应该通过应用程序进行中转，运行在可信的环境中是保证Redis安全的最重要方法。</p><p class="calibre_9">Redis的默认配置会接受来自任何地址发送来的请求，即在任何一个拥有公网IP的服务器上启动 Redis 服务器，都可以被外界直接访问到。要更改这一设置，在配置文件中修改bind参数，如只允许本机应用连接Redis，可以将bind参数改成：</p><p class="calibre_9">bind 127.0.0.1</p><p class="calibre_9">bind参数只能绑定一个地址<sup class="calibre3"><small id="filepos577109" class="calibre4"><a href="index_split_047.html#filepos597528"><span class="calibre5"><span class="calibre_2">[2]</span></span></a></small></sup> ，如果想更自由地设置访问规则需要通过防火墙来完成。</p><p id="filepos577287" class="calibre_6"><a href="index_split_000.html#filepos28079"><span class="calibre6"><span class="bold"><span class="calibre_2">9.1.2 数据库密码</span></span></span></a></p><p class="calibre_14">除此之外，还可以通过配置文件中的requirepass参数为Redis设置一个密码。例如：</p><p class="calibre_9">requirepass TAFK(@~!ji^XALQ(sYh5xIwTn5D$s7JF</p><p class="calibre_9">客户端每次连接到 Redis 时都需要发送密码，否则 Redis 会拒绝执行客户端发来的命令。例如：</p><p class="calibre_9">redis&gt; GET foo</p><p class="calibre_9">(error) ERR operation not permitted</p><p class="calibre_9">发送密码需要使用AUTH命令，就像这样：</p><p class="calibre_9">redis&gt; AUTH TAFK(@~!ji^XALQ(sYh5xIwTn5D$s7JF</p><p class="calibre_9">OK</p><p class="calibre_9">之后就可以执行任何命令了：</p><p class="calibre_9">redis&gt; GET foo</p><p class="calibre_9">"1"</p><p class="calibre_9">由于Redis的性能极高，并且输入错误密码后Redis并不会进行主动延迟（考虑到Redis的单线程模型），所以攻击者可以通过穷举法破解Redis的密码（1秒内能够尝试十几万个密码），因此在设置时一定要选择复杂的密码。</p><p class="calibre_9">提示 配置 Redis 复制的时候如果主数据库设置了密码，需要在从数据库的配置文件中通过masterauth参数设置主数据库的密码，以使从数据库连接主数据库时自动使用AUTH命令认证。</p><p id="filepos579016" class="calibre_6"><a href="index_split_000.html#filepos28272"><span class="calibre6"><span class="bold"><span class="calibre_2">9.1.3 命名命令</span></span></span></a></p><p class="calibre_14">Redis 支持在配置文件中将命令重命名，比如将 FLUSHALL 命令重命名成一个比较复杂的名字，以保证只有自己的应用可以使用该命令。就像这样：</p><p class="calibre_9">rename-command FLUSHALL oyfekmjvmwxq5a9c8usofuo369x0it2k</p><p class="calibre_9">如果希望直接禁用某个命令可以将命令重命名成空字符串：</p><p class="calibre_9">rename-command FLUSHALL ""</p><p class="calibre_9">注意 无论设置密码还是重命名命令，都需要保证配置文件的安全性，否则就没有任何意义了。</p><div class="mbp_pagebreak" id="calibre_pb_45"></div>
</body></html>
