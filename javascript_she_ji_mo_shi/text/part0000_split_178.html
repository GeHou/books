<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>未知</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<h2 id="nav_point_249" class="calibre7"><strong class="calibre6">20.6　开放－封闭原则的相对性</strong></h2>
<p class="calibre1">在职责链模式代码中，大家也许会产生这个疑问：开放-封闭原则要求我们只能通过增加源代码的方式扩展程序的功能，而不允许修改源代码。那当我们往职责链中增加一个新的100元订单函数节点时，不也必须改动设置链条的代码吗？代码如下：</p>
<pre class="Dai Ma Wu Xing Hao "><code class="calibre9">order500yuan.setNextSuccessor( order200yuan ).setNextSuccessor( orderNormal );

</code></pre>
<p class="calibre1">变为：</p>
<pre class="Dai Ma Wu Xing Hao "><code class="calibre9">order500yuan.setNextSuccessor( order200yuan ).setNextSuccessor( order100yuan ).setNextSuccessor( orderNormal );

</code></pre>
<p class="calibre1">实际上，让程序保持完全封闭是不容易做到的。就算技术上做得到，也需要花费太多的时间和精力。而且让程序符合开放-封闭原则的代价是引入更多的抽象层次，更多的抽象有可能会增大代码的复杂度。</p>
<p class="calibre1">更何况，有一些代码是无论如何也不能完全封闭的，总会存在一些无法对其封闭的变化。作为程序员，我们可以做到的有下面两点。</p>
<ul class="calibre14">
<li class="calibre15"><p class="calibre1">挑选出最容易发生变化的地方，然后构造抽象来封闭这些变化。</p>
</li>
<li class="calibre15"><p class="calibre1">在不可避免发生修改的时候，尽量修改那些相对容易修改的地方。拿一个开源库来说，修改它提供的配置文件，总比修改它的源代码来得简单。</p>
</li>
</ul>
<p class="calibre1">比如在第14章中出现的那个巨大的订单函数，它包含了各种订单的逻辑，有500元和200元的，也有普通订单的。这个函数是最有可能发生变化的，一旦增加新的订单，就必须修改这个巨大的函数。而用职责链模式重构之后，我们只需要新增一个节点，然后重新设置链条中节点的连接顺序。重构后的修改方式显然更加清晰简单 。</p>
</body></html>
